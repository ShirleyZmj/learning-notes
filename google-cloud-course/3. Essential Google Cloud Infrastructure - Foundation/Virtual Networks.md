

## Virtual Private Cloud

这段内容主要介绍了Google Cloud VPC（Virtual Private Cloud）网络的基本概念和配置，包括项目、网络、子网以及它们之间的关系。以下是核心要点：

- **项目（Projects）:**
    - 是Google Cloud中资源组织的基本单位。
    - 关联资源和计费。
    - 每个项目默认有15个网络的配额，可以申请增加。
- **网络（Networks）:**
    - 是全局性的，跨越所有可用区域。
    - 不直接分配IP地址范围，而是包含子网和服务的逻辑结构。
    - 可以与其他项目共享或进行网络对等互连。
    - 分为三种类型：默认（default）、自动（auto）和自定义（custom）。
- **子网（Subnetworks）:**
    - 是区域性的，跨越区域内的可用区（zones）。
    - 分配IP地址范围（CIDR块）。
    - 每个子网保留四个IP地址：网络地址、网关地址、倒数第二个地址和广播地址。
    - 子网可以扩大IP地址范围，但是需要遵循一定的规则，例如，不能与同一VPC网络中的其他子网重叠，IP地址范围必须是有效的CIDR块，以及扩大的IP地址范围必须大于原始范围。
    - 自动模式子网可以使用/20的IP范围，并且可以扩展到/16，但是自定义模式子网可以有更大的IP范围。
- **网络类型：**
    - **默认网络：** 自动模式网络，预先配置了子网和防火墙规则，允许ICMP、RDP和SSH流量。
    - **自动模式网络：** 每个区域自动创建一个子网，使用预定义的IP范围（10.128.0.0/9）。
    - **自定义模式网络：** 完全控制子网和IP范围，需要手动创建子网。
- **IPv6:**
    - Google Cloud支持自定义VPC网络模式下的IPv6。
    - 可以配置双栈VM实例，同时运行IPv4和IPv6。
- **网络连通性：**
    - 同一网络内的VM实例可以使用内部IP地址进行通信，即使它们位于不同的区域。
    - 不同网络内的VM实例默认需要使用外部IP地址进行通信。
    - 可以使用VPN将本地网络安全地连接到Google Cloud网络。
- **子网扩展：**
    - 子网IP地址空间可以扩展，但不能缩小。
    - 扩展时需要注意IP地址范围不能重叠，必须是有效的CIDR块。
    - 自动模式子网可以扩展到/16。
    - 避免创建过大的子网，以防止CIDR范围冲突。

**考点总结：**

1. **项目、网络和子网的概念和关系：** 理解它们在Google Cloud资源组织中的作用。
2. **VPC网络类型：** 掌握默认、自动和自定义模式网络的特点和区别，以及它们的应用场景。
3. **子网配置：** 了解子网的IP地址范围、保留地址和扩展规则。
4. **网络连通性：** 理解同一网络和不同网络内VM实例的通信方式，以及VPN的作用。
5. **IP地址管理：** 掌握CIDR块的概念，以及子网IP地址范围的规划和扩展。
6. **IPv6支持：** 了解Google Cloud对IPv6的支持情况。
7. **子网扩展时的规则和注意事项：** 了解扩展子网时不能重叠，和必须是有效的cidr等规则。
8. **子网大小规划：** 了解子网过大的风险。

### VPCc  network types

![[Pasted image 20250408124937.png]]

## IP addresses

![[Pasted image 20250408150555.png]]

**内容总结：**

这段内容详细介绍了Google Cloud中虚拟机（VM）的IP地址分配和管理，主要包括内部IP地址和外部IP地址：

- **内部IP地址（Internal IP Address）：**
    - 每个VM都会自动分配一个内部IP地址。
    - 通过DHCP内部动态分配。
    - Google Cloud内部DNS服务会将VM的符号名称解析为内部IP地址。
    - DNS的作用域限定于网络，只能解析同一网络内的主机名。
    - App Engine和Google Kubernetes Engine等依赖VM的服务也会使用内部IP地址。
- **外部IP地址（External IP Address）：**
    - 是可选的，用于外部访问VM。
    - 可以从IP地址池中动态分配（临时IP地址，ephemeral）。
    - 也可以从预留的外部IP地址中静态分配（静态IP地址，static）。
    - 预留但未使用的静态外部IP地址会产生更高的费用。
    - 用户可以自带公网IP地址段，/24或者更大的地址段。
- **IP地址管理：**
    - 理解内部和外部IP地址的分配和使用场景。
    - 理解静态IP和动态IP的费用区别。
    - 理解用户自带公网IP的要求。

**考点总结：**

1. **内部IP地址的分配和作用：**
    - 理解内部IP地址的动态分配机制。
    - 掌握内部DNS的作用域和解析范围。
    - 理解内部IP在GKE，App Engine等服务中的应用。
2. **外部IP地址的类型和管理：**
    - 区分临时（ephemeral）和静态（static）外部IP地址的特点和使用场景。
    - 了解预留未使用的静态外部IP地址的费用。
    - 了解用户自带公网IP的要求。
3. **IP地址费用：**
    - 理解静态IP在不同使用状态下的费用区别。
4. **网络安全：**
    - 理解内部和外部IP地址在网络安全中的作用。
5. **DNS解析：**
    - 理解内部DNS的解析范围。



> 在新建了一个vm instance后，会根据配置被分配internal和external ip address。当停止vm instance服务后，external ip会消失。restart后，会分配个全新的external ip


## Mapping IP addresses

**内容总结：**

这段内容深入探讨了Google Cloud中VM实例的IP地址和DNS解析，以及Alias IP Ranges的使用。主要包括以下几个方面：

- **内部和外部IP地址的透明映射：**
    - VM实例的操作系统（OS）无法直接感知外部IP地址，外部IP地址通过VPC透明地映射到内部IP地址。
    - `ifconfig`命令只能显示内部IP地址。
- **内部DNS解析：**
    - Google Cloud提供区域（Zonal）和全局（Global）两种内部DNS服务，推荐使用区域DNS以获得更高的可靠性。
    - 每个实例都有一个主机名（与实例名相同）和一个FQDN（Fully Qualified Domain Name），用于内部DNS解析。
    - 实例的内部IP地址可能会在删除和重建后更改，但DNS名称始终指向该实例。
    - 实例的元数据服务器（metadata server）作为DNS解析器，处理本地网络资源查询，并将其他查询路由到Google的公共DNS服务器。
- **外部DNS解析：**
    - 外部IP地址允许外部主机连接到VM实例。
    - 公共DNS记录不会自动发布，需要管理员使用现有DNS服务器或Cloud DNS进行发布。
- **Cloud DNS：**
    - 是Google Cloud提供的可扩展、可靠的托管权威DNS服务。
    - 使用Google的Anycast名称服务器，提供低延迟和高可用性。
    - 提供100%的SLA。
    - 支持通过UI、CLI或API管理DNS记录。
- **Alias IP Ranges（别名IP范围）：**
    - 允许将一系列内部IP地址作为别名分配给VM实例的网络接口。
    - 适用于在单个VM上运行多个服务，并为每个服务分配不同IP地址的场景。
    - 从本地子网的主或次CIDR范围中分配别名IP范围。

**考点和答案：**

1. **考点：VM实例如何处理外部IP地址？**
    
    - **答案：**VM实例的操作系统无法直接感知外部IP地址。外部IP地址通过VPC透明地映射到内部IP地址。
2. **考点：Google Cloud的内部DNS解析类型有哪些？推荐使用哪种？**
    
    - **答案：**Google Cloud提供区域（Zonal）和全局（Global）两种内部DNS服务。推荐使用区域DNS，因为它提供更高的可靠性。
3. **考点：VM实例的内部DNS名称如何构成？如果删除并重建VM实例，内部IP地址和DNS名称会如何变化？**
    
    - **答案：**VM实例的内部DNS名称包括主机名（与实例名相同）和FQDN。如果删除并重建VM实例，内部IP地址可能会更改，但DNS名称始终指向该实例。
4. **考点：VM实例的元数据服务器在DNS解析中扮演什么角色？**
    
    - **答案：**元数据服务器作为DNS解析器，处理本地网络资源查询，并将其他查询路由到Google的公共DNS服务器。
5. **考点：如何发布VM实例的外部DNS记录？**
    
    - **答案：**管理员可以使用现有DNS服务器或Cloud DNS发布VM实例的外部DNS记录。
6. **考点：Cloud DNS的优势是什么？**
    
    - **答案：**Cloud DNS具有可扩展性、可靠性、高可用性（100% SLA），并简化了DNS记录的管理。
7. **考点：Alias IP Ranges的作用是什么？如何使用？**
    
    - **答案：**Alias IP Ranges允许将一系列内部IP地址作为别名分配给VM实例的网络接口，适用于在单个VM上运行多个服务，并为每个服务分配不同IP地址的场景。从本地子网的主或次CIDR范围中分配别名IP范围。

![[Pasted image 20250408154548.png]]

[[如何分配 Alias IP]]
[[Alias IP Ranges 作用和使用]]
[[主CIDR 和 次CIDR 不能重叠]]
[[子网掩码 和 CIDR]]

