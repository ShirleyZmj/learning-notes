### **📌 Cloud Monitoring 的告警机制**

在 **Google Cloud Monitoring** 中，告警（Alerts）是通过 **告警策略（Alert Policies）** 来定义的。

---

## **1️⃣ 告警策略的组成**

### **（1）What：告警条件**

告警策略的 **“What”** 部分定义了触发告警的条件，包括：

- **监控资源（Monitored Resource）**：要监控的云资源（VM 实例、数据库等）。
- **监控指标（Metric）**：比如 CPU 使用率、内存占用率、请求失败率等。
- **阈值（Threshold）**：触发告警的数值范围，比如 CPU 使用率 > 80%。
- **条件逻辑**：最多可设置 **6 个条件**，可以指定 **多个条件的组合方式**：
    - **任何一个条件满足（OR）** → 触发告警
    - **所有条件满足（AND）** → 触发告警

---

### **（2）How：通知方式**

告警策略的 **“How”** 部分定义了如何通知相关人员：

- **通知渠道（Notification Channels）**：
    - **电子邮件（Email）**
    - **Slack 频道**
    - **Pub/Sub 主题**
    - **短信**
    - **PagerDuty**
- **文档说明（Documentation）**：
    - 触发告警时，可以附带相关信息，如故障排除步骤。

---

## **2️⃣ 告警策略的工作流程**

1. **监控 Cloud 资源（Metrics）**，如：
    - GCE 实例 CPU 使用率 > 80%
    - 负载均衡请求失败率 > 5%
2. **定义告警条件（Conditions）**
3. **触发告警（Incidents）**
4. **通知相关人员（Notifications）**
5. **解决问题后**，告警自动恢复（Incident Closed）

---

## **3️⃣ 示例：CPU 使用率告警**

**目标：当某个 GCE VM 实例的 CPU 使用率超过 80% 时发送 Slack 通知**

### **（1）创建告警策略**

- **监控资源**：GCE VM 实例
- **监控指标**：CPU 使用率
- **阈值**：> 80%
- **持续时间**：5 分钟
- **通知渠道**：Slack 频道

### **（2）通知示例**

> **[警告] VM-Instance-1 CPU 使用率超 80%！**  
> 请检查实例的负载情况并优化资源分配。

---

## **4️⃣ 重点总结**

✅ **告警策略由“触发条件（What）”和“通知方式（How）”组成。**  
✅ **最多支持 6 个触发条件，并可组合（AND / OR）。**  
✅ **支持多种通知方式（Email、Slack、Pub/Sub 等）。**  
✅ **告警自动生成“事件（Incident）”，并在问题解决后自动关闭。**